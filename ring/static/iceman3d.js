
"use strict";var ICEMAN3D=function(){this.mainVersion=0};ICEMAN3D.Eps=1e-8;ICEMAN3D.Inf=9999999999;ICEMAN3D.RadDeg=57.29577951308232;ICEMAN3D.DegRad=0.017453292519943;ICEMAN3D.IsZero=function(b){return Math.abs(b)<ICEMAN3D.Eps};ICEMAN3D.IsPositive=function(b){return b>ICEMAN3D.Eps};ICEMAN3D.IsNegative=function(b){return b<-ICEMAN3D.Eps};ICEMAN3D.IsLower=function(d,c){return c-d>ICEMAN3D.Eps};ICEMAN3D.IsGreater=function(d,c){return d-c>ICEMAN3D.Eps};ICEMAN3D.IsEqual=function(d,c){return Math.abs(c-d)<ICEMAN3D.Eps};ICEMAN3D.IsEqualWithEps=function(e,c,d){return Math.abs(c-e)<d};ICEMAN3D.IsLowerOrEqual=function(d,c){return ICEMAN3D.IsLower(d,c)||ICEMAN3D.IsEqual(d,c)};ICEMAN3D.IsGreaterOrEqual=function(d,c){return ICEMAN3D.IsGreater(d,c)||ICEMAN3D.IsEqual(d,c)};ICEMAN3D.Minimum=function(d,c){return ICEMAN3D.IsLower(d,c)?d:c};ICEMAN3D.Maximum=function(d,c){return ICEMAN3D.IsGreater(d,c)?d:c};ICEMAN3D.ArcSin=function(a){if(ICEMAN3D.IsGreaterOrEqual(a,1)){return Math.PI/2}else{if(ICEMAN3D.IsLowerOrEqual(a,-1)){return -Math.PI/2}}return Math.asin(a)};ICEMAN3D.ArcCos=function(a){if(ICEMAN3D.IsGreaterOrEqual(a,1)){return 0}else{if(ICEMAN3D.IsLowerOrEqual(a,-1)){return Math.PI}}return Math.acos(a)};ICEMAN3D.RandomNumber=function(b,a){return Math.random()*(a-b)+b};ICEMAN3D.RandomInt=function(b,a){return Math.floor((Math.random()*(a-b+1))+b)};ICEMAN3D.SeededRandomInt=function(d,c,a){var b=((a*9301+49297)%233280)/233280;return Math.floor((b*(c-d+1))+d)};ICEMAN3D.ValueOrDefault=function(b,a){if(b===undefined||b===null){return a}return b};ICEMAN3D.CopyObjectProperties=function(c,d,a){if(c===undefined||c===null||d===undefined||d===null){return}var b;for(b in c){if(c.hasOwnProperty(b)){if(a||d[b]===undefined||d[b]===null){d[b]=c[b]}}}};ICEMAN3D.Assert=function(c,a){if(!c){var b="Assertion failed.";if(a!==undefined&&a!==null){b+=" "+a}alert(b)}};ICEMAN3D.IsWebGLEnabled=function(){if(!window.WebGLRenderingContext){return false}try{var a=document.createElement("canvas");if(!a.getContext("experimental-webgl")&&!a.getContext("webgl")){this.GetWebGLErrorMessage();return false}}catch(b){return false}return true};ICEMAN3D.IsFileApiEnabled=function(){if(!window.File||!window.FileReader||!window.FileList||!window.Blob||!window.URL){return false}return true};ICEMAN3D.GetWebGLErrorMessage=function(){var a=document.createElement("div");a.id="webgl-error-message";a.style.fontFamily="monospace";a.style.fontSize="14px";a.style.fontWeight="normal";a.style.textAlign="center";a.style.background="#fff";a.style.color="#ff0000";a.style.padding="1.5em 0";a.style.width="660px";a.style.margin="5em auto 0";a.style.position="absolute";a.style.top="0";a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.<br /><br />','您的显卡不支持 <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','如何解决请 <a href="http://get.webgl.org/" style="color:#000">查看</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.<br /><br />','您的浏览器不支持 <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">3D渲染</a>.<br />',"请升级您的浏览器至 Chrome谷歌浏览器、360极速、火狐、Safari等其他浏览器."].join("\n");document.getElementById("container").appendChild(a)};ICEMAN3D.Coord2D=function(a,b){this.x=a;this.y=b};ICEMAN3D.Coord2D.prototype.Set=function(a,b){this.x=a;this.y=b};ICEMAN3D.Coord2D.prototype.ToString=function(){return("("+this.x+", "+this.y+")")};ICEMAN3D.Coord2D.prototype.Clone=function(){return new ICEMAN3D.Coord2D(this.x,this.y)};ICEMAN3D.PolarCoord=function(a,b){this.radius=a;this.angle=b};ICEMAN3D.PolarCoord.prototype.Set=function(a,b){this.radius=a;this.angle=b};ICEMAN3D.PolarCoord.prototype.ToString=function(){return("("+this.radius+", "+this.angle+")")};ICEMAN3D.PolarCoord.prototype.Clone=function(){return new ICEMAN3D.PolarCoord(this.radius,this.angle)};ICEMAN3D.Coord=function(a,c,b){this.x=a;this.y=c;this.z=b};ICEMAN3D.Coord.prototype.Set=function(a,c,b){this.x=a;this.y=c;this.z=b};ICEMAN3D.Coord.prototype.ToString=function(){return("("+this.x+", "+this.y+", "+this.z+")")};ICEMAN3D.Coord.prototype.Clone=function(){return new ICEMAN3D.Coord(this.x,this.y,this.z)};ICEMAN3D.SphericalCoord=function(a,b,c){this.radius=a;this.theta=b;this.phi=c};ICEMAN3D.SphericalCoord.prototype.Set=function(a,b,c){this.radius=a;this.theta=b;this.phi=c};ICEMAN3D.SphericalCoord.prototype.ToString=function(){return("("+this.radius+", "+this.theta+", "+this.phi+")")};ICEMAN3D.SphericalCoord.prototype.Clone=function(){return new ICEMAN3D.SphericalCoord(this.radius,this.theta,this.phi)};ICEMAN3D.Vector2D=ICEMAN3D.Coord2D;ICEMAN3D.Vector=ICEMAN3D.Coord;ICEMAN3D.CoordFromArray=function(a){return new ICEMAN3D.Coord(a[0],a[1],a[2])};ICEMAN3D.CoordToArray=function(a){return[a.x,a.y,a.z]};ICEMAN3D.CoordIsEqual=function(d,c){return ICEMAN3D.IsEqual(d.x,c.x)&&ICEMAN3D.IsEqual(d.y,c.y)&&ICEMAN3D.IsEqual(d.z,c.z)};ICEMAN3D.CoordIsEqualWithEps=function(e,c,d){return ICEMAN3D.IsEqualWithEps(e.x,c.x,d)&&ICEMAN3D.IsEqualWithEps(e.y,c.y,d)&&ICEMAN3D.IsEqualWithEps(e.z,c.z,d)};ICEMAN3D.CoordAdd=function(d,c){return new ICEMAN3D.Coord(d.x+c.x,d.y+c.y,d.z+c.z)};ICEMAN3D.CoordSub=function(d,c){return new ICEMAN3D.Coord(d.x-c.x,d.y-c.y,d.z-c.z)};ICEMAN3D.SphericalCoordIsEqual=function(d,c){return ICEMAN3D.IsEqual(d.radius,c.radius)&&ICEMAN3D.IsEqual(d.phi,c.phi)&&ICEMAN3D.IsEqual(d.theta,c.theta)};ICEMAN3D.CoordDistance=function(d,c){var f=d.x;var h=d.y;var j=d.z;var e=c.x;var g=c.y;var i=c.z;return Math.sqrt((e-f)*(e-f)+(g-h)*(g-h)+(i-j)*(i-j))};ICEMAN3D.CoordSignedDistance=function(d,c,f){var e=ICEMAN3D.CoordSub(c,d);var h=ICEMAN3D.CoordDistance(d,c);var g=ICEMAN3D.GetVectorsAngle(e,f);if(ICEMAN3D.IsPositive(g)){h=-h}return h};ICEMAN3D.MidCoord=function(d,c){return new ICEMAN3D.Coord((d.x+c.x)/2,(d.y+c.y)/2,(d.z+c.z)/2)};ICEMAN3D.VectorMultiply=function(b,c){var a=new ICEMAN3D.Vector(0,0,0);a.x=b.x*c;a.y=b.y*c;a.z=b.z*c;return a};ICEMAN3D.VectorDot=function(d,c){return d.x*c.x+d.y*c.y+d.z*c.z};ICEMAN3D.VectorCross=function(e,d){var c=new ICEMAN3D.Vector(0,0,0);c.x=e.y*d.z-e.z*d.y;c.y=e.z*d.x-e.x*d.z;c.z=e.x*d.y-e.y*d.x;return c};ICEMAN3D.VectorLength=function(b){var a=b.x;var d=b.y;var c=b.z;return Math.sqrt(a*a+d*d+c*c)};ICEMAN3D.VectorNormalize=function(b){var c=ICEMAN3D.VectorLength(b);var a=new ICEMAN3D.Vector(0,0,0);if(ICEMAN3D.IsGreater(c,0)){a=ICEMAN3D.VectorMultiply(b,1/c)}return a};ICEMAN3D.VectorSetLength=function(b,d){var c=d/ICEMAN3D.VectorLength(b);var a=ICEMAN3D.VectorMultiply(b,c);return a};ICEMAN3D.CoordOffset=function(e,c,d){var b=ICEMAN3D.VectorNormalize(c);var a=new ICEMAN3D.Coord(0,0,0);a.x=e.x+b.x*d;a.y=e.y+b.y*d;a.z=e.z+b.z*d;return a};ICEMAN3D.CoordRotate=function(e,b,c,k){var a=ICEMAN3D.CoordSub(e,k);var f=ICEMAN3D.VectorNormalize(b);var n=f.x;var m=f.y;var l=f.z;var j=a.x;var i=a.y;var g=a.z;var d=Math.sin(c);var h=Math.cos(c);var o=new ICEMAN3D.Coord(0,0,0);o.x=-n*(-n*j-m*i-l*g)*(1-h)+j*h+(-l*i+m*g)*d;o.y=-m*(-n*j-m*i-l*g)*(1-h)+i*h+(l*j-n*g)*d;o.z=-l*(-n*j-m*i-l*g)*(1-h)+g*h+(-m*j+n*i)*d;o=ICEMAN3D.CoordAdd(o,k);return o};ICEMAN3D.GetVectorsAngle=function(e,d){var g=ICEMAN3D.VectorNormalize(e);var c=ICEMAN3D.VectorNormalize(d);if(ICEMAN3D.CoordIsEqual(g,c)){return 0}var f=ICEMAN3D.VectorDot(g,c);return ICEMAN3D.ArcCos(f)};ICEMAN3D.GetVectorsFullAngle=function(d,c,e){var g=ICEMAN3D.GetVectorsAngle(d,c);var f=new ICEMAN3D.Coord(0,0,0);if(ICEMAN3D.CoordTurnType(d,f,c,e)=="Clockwise"){g=2*Math.PI-g}return g};ICEMAN3D.VectorsAreCollinear=function(d,c){var e=ICEMAN3D.GetVectorsAngle(d,c);return ICEMAN3D.IsEqual(e,0)||ICEMAN3D.IsEqual(e,Math.PI)};ICEMAN3D.GetCoord2DFromCoord=function(g,e,c){var f=new ICEMAN3D.Vector(0,0,1);var b=ICEMAN3D.VectorCross(c,f);var d=ICEMAN3D.GetVectorsAngle(c,f);var a=ICEMAN3D.CoordRotate(g,b,d,e);return new ICEMAN3D.Coord2D(a.x,a.y)};ICEMAN3D.CoordTurnType=function(m,k,i,h){var l=new ICEMAN3D.Coord(0,0,0);var d=ICEMAN3D.GetCoord2DFromCoord(m,l,h);var j=ICEMAN3D.GetCoord2DFromCoord(k,l,h);var g=ICEMAN3D.GetCoord2DFromCoord(i,l,h);var e=ICEMAN3D.CoordTurnType2D(d,j,g);var n=new ICEMAN3D.Vector(0,0,1);var f=ICEMAN3D.GetVectorsAngle(h,n);if(ICEMAN3D.IsEqual(f,Math.PI)){if(e==="CounterClockwise"){e="Clockwise"}else{if(e==="Clockwise"){e="CounterClockwise"}}}return e};ICEMAN3D.CalculateCentroid=function(d){var c=d.length;var b=new ICEMAN3D.Coord(0,0,0);if(c>=1){var a;for(a=0;a<c;a++){b=ICEMAN3D.CoordAdd(b,d[a])}b=ICEMAN3D.VectorMultiply(b,1/c)}return b};ICEMAN3D.CalculateTriangleNormal=function(a,g,f){var c=ICEMAN3D.CoordSub(g,a);var b=ICEMAN3D.CoordSub(f,a);var d=new ICEMAN3D.Vector(0,0,0);d.x=(c.y*b.z-c.z*b.y);d.y=(c.z*b.x-c.x*b.z);d.z=(c.x*b.y-c.y*b.x);var e=ICEMAN3D.VectorNormalize(d);return e};ICEMAN3D.CalculateNormal=function(h){var d=h.length;var e=new ICEMAN3D.Vector(0,0,0);if(d>=3){var a,g,c;var f,b;for(a=0;a<d;a++){g=a%d;c=(a+1)%d;f=h[g];b=h[c];e.x+=(f.y-b.y)*(f.z+b.z);e.y+=(f.z-b.z)*(f.x+b.x);e.z+=(f.x-b.x)*(f.y+b.y)}}var j=ICEMAN3D.VectorNormalize(e);return j};ICEMAN3D.BarycentricInterpolation=function(i,c,a,g,d,b,v){function r(y,w,A){var z=(y+w+A)/2;var x=z*(z-y)*(z-w)*(z-A);if(x<0){return 0}return Math.sqrt(x)}var j=ICEMAN3D.CoordDistance(i,c);var h=ICEMAN3D.CoordDistance(c,a);var e=ICEMAN3D.CoordDistance(a,i);var p=ICEMAN3D.CoordDistance(i,v);var n=ICEMAN3D.CoordDistance(c,v);var l=ICEMAN3D.CoordDistance(a,v);var s=r(j,h,e);if(ICEMAN3D.IsZero(s)){return g}var o=r(j,p,n);var m=r(h,n,l);var k=r(e,p,l);var u=ICEMAN3D.VectorMultiply(g,m);var t=ICEMAN3D.VectorMultiply(d,k);var q=ICEMAN3D.VectorMultiply(b,o);var f=ICEMAN3D.CoordAdd(ICEMAN3D.CoordAdd(u,t),q);return ICEMAN3D.VectorMultiply(f,1/s)};ICEMAN3D.SphericalToCartesian=function(b,c,d){var a=new ICEMAN3D.Coord(0,0,0);a.x=b*Math.sin(c)*Math.cos(d);a.y=b*Math.sin(c)*Math.sin(d);a.z=b*Math.cos(c);return a};ICEMAN3D.CartesianToSpherical=function(b,d,c){var a=new ICEMAN3D.SphericalCoord(0,0,0);a.radius=Math.sqrt(b*b+d*d+c*c);if(ICEMAN3D.IsZero(a.radius)){return a}a.theta=Math.acos(c/a.radius);a.phi=Math.atan2(d,b);return a};ICEMAN3D.SphericalToCartesianWithOrigo=function(a,d){var c=ICEMAN3D.SphericalToCartesian(a.radius,a.theta,a.phi);var b=ICEMAN3D.CoordAdd(c,d);return b};ICEMAN3D.CartesianToSphericalWithOrigo=function(c,d){var b=ICEMAN3D.CoordSub(c,d);var a=ICEMAN3D.CartesianToSpherical(b.x,b.y,b.z);return a};ICEMAN3D.MoveCoordOnSphere=function(f,d,b,e){var a=ICEMAN3D.CartesianToSphericalWithOrigo(f,d);a.theta+=b;a.phi+=e;var c=ICEMAN3D.SphericalToCartesianWithOrigo(a,d);return c};ICEMAN3D.CylindricalToCartesian=function(c,b,d){var a=new ICEMAN3D.Coord(0,0,0);a.x=c*Math.cos(d);a.y=c*Math.sin(d);a.z=b;return a};ICEMAN3D.GetArcLength=function(e,d,c){var f=ICEMAN3D.GetVectorsAngle(e,d);return f*c};ICEMAN3D.GetFullArcLength=function(e,d,c,f){var g=ICEMAN3D.GetVectorsFullAngle(e,d,f);return g*c};ICEMAN3D.Camera=function(c,b,a,f,d,e){this.eye=ICEMAN3D.ValueOrDefault(c,new ICEMAN3D.Coord(1,1,1));this.center=ICEMAN3D.ValueOrDefault(b,new ICEMAN3D.Coord(0,0,0));this.up=ICEMAN3D.ValueOrDefault(a,new ICEMAN3D.Vector(0,0,1));this.fieldOfView=ICEMAN3D.ValueOrDefault(f,45);this.nearClippingPlane=ICEMAN3D.ValueOrDefault(d,0.1);this.farClippingPlane=ICEMAN3D.ValueOrDefault(e,1000)};ICEMAN3D.Camera.prototype.Set=function(c,b,a,f,d,e){this.eye=c;this.center=b;this.up=a;this.fieldOfView=ICEMAN3D.ValueOrDefault(f,45);this.nearClippingPlane=ICEMAN3D.ValueOrDefault(d,0.1);this.farClippingPlane=ICEMAN3D.ValueOrDefault(e,1000)};ICEMAN3D.Camera.prototype.Clone=function(){var a=new ICEMAN3D.Camera();a.eye=this.eye;a.center=this.center;a.up=this.up;a.fieldOfView=this.fieldOfView;a.nearClippingPlane=this.nearClippingPlane;a.farClippingPlane=this.farClippingPlane;return a};ICEMAN3D.Navigation=function(){this.canvas=null;this.camera=null;this.drawCallback=null;this.resizeCallback=null;this.mouse=null;this.touch=null;this.cameraFixUp=null;this.cameraEnableOrbit=null;this.cameraEnablePan=null;this.cameraEnableZoom=null;this.cameraNearDistanceLimit=null;this.cameraFarDistanceLimit=null;this.orbitCenter=null};ICEMAN3D.Navigation.prototype.Init=function(b,c,e,d){this.canvas=b;this.camera=c;this.drawCallback=e;this.resizeCallback=d;this.mouse=new ICEMAN3D.Mouse();this.touch=new ICEMAN3D.Touch();this.cameraFixUp=true;this.cameraEnableOrbit=true;this.cameraEnablePan=true;this.cameraEnableZoom=true;this.cameraNearDistanceLimit=0.1;this.cameraFarDistanceLimit=1000;this.orbitCenter=this.camera.center.Clone();var a=this;if(document.addEventListener){document.addEventListener("mousemove",function(f){a.OnMouseMove(f)});document.addEventListener("mouseup",function(f){a.OnMouseUp(f)})}if(this.canvas.addEventListener){this.canvas.addEventListener("mousedown",function(f){a.OnMouseDown(f)},false);this.canvas.addEventListener("DOMMouseScroll",function(f){a.OnMouseWheel(f)},false);this.canvas.addEventListener("mousewheel",function(f){a.OnMouseWheel(f)},false);this.canvas.addEventListener("touchstart",function(f){a.OnTouchStart(f)},false);this.canvas.addEventListener("touchmove",function(f){a.OnTouchMove(f)},false);this.canvas.addEventListener("touchend",function(f){a.OnTouchEnd(f)},false);this.canvas.addEventListener("contextmenu",function(f){a.OnContextMenu(f)},false)}if(window.addEventListener){window.addEventListener("resize",function(f){a.OnResize(f)},false)}return true};ICEMAN3D.Navigation.prototype.SetCamera=function(c,b,a){this.camera.Set(c,b,a);this.orbitCenter=this.camera.center.Clone()};ICEMAN3D.Navigation.prototype.EnableFixUp=function(a){this.cameraFixUp=a};ICEMAN3D.Navigation.prototype.EnableOrbit=function(a){this.cameraEnableOrbit=a};ICEMAN3D.Navigation.prototype.EnablePan=function(a){this.cameraEnablePan=a};ICEMAN3D.Navigation.prototype.EnableZoom=function(a){this.cameraEnableZoom=a};ICEMAN3D.Navigation.prototype.SetNearDistanceLimit=function(a){this.cameraNearDistanceLimit=a};ICEMAN3D.Navigation.prototype.SetFarDistanceLimit=function(a){this.cameraFarDistanceLimit=a};ICEMAN3D.Navigation.prototype.SetOrbitCenter=function(a){this.orbitCenter=a};ICEMAN3D.Navigation.prototype.FitInWindow=function(c,b){var d=ICEMAN3D.CoordSub(this.camera.center,c);this.camera.center=c;this.camera.eye=ICEMAN3D.CoordSub(this.camera.eye,d);var a=ICEMAN3D.VectorNormalize(ICEMAN3D.CoordSub(this.camera.eye,this.camera.center));var e=this.camera.fieldOfView/2;if(this.canvas.width<this.canvas.height){e=e*this.canvas.width/this.canvas.height}var f=b/Math.sin(e*ICEMAN3D.DegRad);this.camera.eye=ICEMAN3D.CoordOffset(this.camera.center,a,f);this.orbitCenter=this.camera.center.Clone()};ICEMAN3D.Navigation.prototype.Orbit=function(i,h){var c=i*ICEMAN3D.DegRad;var b=h*ICEMAN3D.DegRad;var f=ICEMAN3D.VectorNormalize(ICEMAN3D.CoordSub(this.camera.center,this.camera.eye));var j=ICEMAN3D.VectorNormalize(ICEMAN3D.VectorCross(f,this.camera.up));var a=!ICEMAN3D.CoordIsEqual(this.orbitCenter,this.camera.center);if(this.cameraFixUp){var d=ICEMAN3D.GetVectorsAngle(f,this.camera.up);var e=d+b;if(ICEMAN3D.IsGreater(e,0)&&ICEMAN3D.IsLower(e,Math.PI)){this.camera.eye=ICEMAN3D.CoordRotate(this.camera.eye,j,-b,this.orbitCenter);if(a){this.camera.center=ICEMAN3D.CoordRotate(this.camera.center,j,-b,this.orbitCenter)}}this.camera.eye=ICEMAN3D.CoordRotate(this.camera.eye,this.camera.up,-c,this.orbitCenter);if(a){this.camera.center=ICEMAN3D.CoordRotate(this.camera.center,this.camera.up,-c,this.orbitCenter)}}else{var g=ICEMAN3D.VectorNormalize(ICEMAN3D.VectorCross(j,f));this.camera.eye=ICEMAN3D.CoordRotate(this.camera.eye,j,-b,this.orbitCenter);this.camera.eye=ICEMAN3D.CoordRotate(this.camera.eye,g,-c,this.orbitCenter);if(a){this.camera.center=ICEMAN3D.CoordRotate(this.camera.center,j,-b,this.orbitCenter);this.camera.center=ICEMAN3D.CoordRotate(this.camera.center,g,-c,this.orbitCenter)}this.camera.up=g}};ICEMAN3D.Navigation.prototype.Pan=function(c,b){var d=ICEMAN3D.VectorNormalize(ICEMAN3D.CoordSub(this.camera.center,this.camera.eye));var e=ICEMAN3D.VectorNormalize(ICEMAN3D.VectorCross(d,this.camera.up));var a=ICEMAN3D.VectorNormalize(ICEMAN3D.VectorCross(e,d));this.camera.eye=ICEMAN3D.CoordOffset(this.camera.eye,e,-c);this.camera.center=ICEMAN3D.CoordOffset(this.camera.center,e,-c);this.camera.eye=ICEMAN3D.CoordOffset(this.camera.eye,a,b);this.camera.center=ICEMAN3D.CoordOffset(this.camera.center,a,b)};ICEMAN3D.Navigation.prototype.Zoom=function(d){var b=ICEMAN3D.CoordSub(this.camera.center,this.camera.eye);var c=ICEMAN3D.VectorLength(b);if(d&&c<this.cameraNearDistanceLimit){return 0}else{if(!d&&c>this.cameraFarDistanceLimit){return 0}}var a=c*0.1;if(!d){a=a*-1}this.camera.eye=ICEMAN3D.CoordOffset(this.camera.eye,b,a)};ICEMAN3D.Navigation.prototype.DrawCallback=function(){if(this.drawCallback!==undefined&&this.drawCallback!==null){this.drawCallback()}};ICEMAN3D.Navigation.prototype.ResizeCallback=function(){if(this.resizeCallback!==undefined&&this.resizeCallback!==null){this.resizeCallback()}};ICEMAN3D.Navigation.prototype.OnMouseDown=function(a){a.preventDefault();this.mouse.Down(a,this.canvas)};ICEMAN3D.Navigation.prototype.OnMouseMove=function(c){c.preventDefault();this.mouse.Move(c,this.canvas);if(!this.mouse.down){return}var b=0;if(this.mouse.button==1){if(!this.cameraEnableOrbit){return}b=0.5;this.Orbit(this.mouse.diffX*b,this.mouse.diffY*b);this.DrawCallback()}else{if(this.mouse.button==3){if(!this.cameraEnablePan){return}var a=ICEMAN3D.CoordDistance(this.camera.eye,this.camera.center);b=0.001*a;this.Pan(this.mouse.diffX*b,this.mouse.diffY*b);this.DrawCallback()}}};ICEMAN3D.Navigation.prototype.OnMouseUp=function(a){a.preventDefault();this.mouse.Up(a,this.canvas)};ICEMAN3D.Navigation.prototype.OnMouseOut=function(a){a.preventDefault();this.mouse.Out(a,this.canvas)};ICEMAN3D.Navigation.prototype.OnMouseWheel=function(b){b.preventDefault();if(!this.cameraEnableZoom){return}var a=b;if(a===null){a=window.event}var d=0;if(a.detail){d=-a.detail}else{if(a.wheelDelta){d=a.wheelDelta/40}}var c=d>0;this.Zoom(c);this.DrawCallback()};ICEMAN3D.Navigation.prototype.OnTouchStart=function(a){a.preventDefault();this.touch.Start(a,this.canvas)};ICEMAN3D.Navigation.prototype.OnTouchMove=function(b){b.preventDefault();this.touch.Move(b,this.canvas);if(!this.touch.down){return}if(!this.cameraEnableOrbit){return}var a=0.5;this.Orbit(this.touch.diffX*a,this.touch.diffY*a);this.DrawCallback()};ICEMAN3D.Navigation.prototype.OnTouchEnd=function(a){a.preventDefault();this.touch.End(a,this.canvas)};ICEMAN3D.Navigation.prototype.OnContextMenu=function(a){a.preventDefault()};ICEMAN3D.Navigation.prototype.OnResize=function(a){a.preventDefault();this.ResizeCallback()};ICEMAN3D.Mouse=function(){this.down=false;this.button=0;this.shift=false;this.ctrl=false;this.alt=false;this.prevX=0;this.prevY=0;this.currX=0;this.currY=0;this.diffX=0;this.diffY=0};ICEMAN3D.Mouse.prototype.Down=function(b,c){var a=b;if(a===undefined){a=window.event}this.down=true;this.button=b.which;this.shift=b.shiftKey;this.ctrl=b.ctrlKey;this.alt=b.altKey;this.SetCurrent(a,c);this.prevX=this.currX;this.prevY=this.currY};ICEMAN3D.Mouse.prototype.Move=function(b,c){var a=b;if(a===undefined){a=window.event}this.shift=b.shiftKey;this.ctrl=b.ctrlKey;this.alt=b.altKey;this.SetCurrent(a,c);this.diffX=this.currX-this.prevX;this.diffY=this.currY-this.prevY;this.prevX=this.currX;this.prevY=this.currY};ICEMAN3D.Mouse.prototype.Up=function(b,c){var a=b;if(a===undefined){a=window.event}this.down=false;this.SetCurrent(a,c)};ICEMAN3D.Mouse.prototype.Out=function(b,c){var a=b;if(a===undefined){a=window.event}this.down=false;this.SetCurrent(a,c)};ICEMAN3D.Mouse.prototype.SetCurrent=function(a,b){this.currX=a.clientX;this.currY=a.clientY;if(b!==undefined&&b.offsetLeft!==undefined&&b.offsetTop!==undefined){this.currX=this.currX-b.offsetLeft;this.currY=this.currY-b.offsetTop}};ICEMAN3D.Touch=function(){this.down=false;this.prevX=0;this.prevY=0;this.currX=0;this.currY=0;this.diffX=0;this.diffY=0};ICEMAN3D.Touch.prototype.Start=function(a,c){if(a.touches.length===0){return}var b=a.touches[0];this.down=true;this.SetCurrent(b,c);this.prevX=this.currX;this.prevY=this.currY};ICEMAN3D.Touch.prototype.Move=function(a,c){if(a.touches.length===0){return}var b=a.touches[0];this.SetCurrent(b,c);this.diffX=this.currX-this.prevX;this.diffY=this.currY-this.prevY;this.prevX=this.currX;this.prevY=this.currY};ICEMAN3D.Touch.prototype.End=function(a,c){if(a.touches.length===0){return}var b=a.touches[0];this.down=false;this.SetCurrent(b,c)};ICEMAN3D.Touch.prototype.SetCurrent=function(b,a){this.currX=b.pageX;this.currY=b.pageY;if(a!==undefined&&a.offsetLeft!==undefined&&a.offsetTop!==undefined){this.currX=b.pageX-a.offsetLeft;this.currY=b.pageY-a.offsetTop}};ICEMAN3D.Box2D=function(b,a){this.min=b;this.max=a};ICEMAN3D.Box2D.prototype.Set=function(b,a){this.min=b;this.max=a};ICEMAN3D.Box2D.prototype.GetCenter=function(){return ICEMAN3D.MidCoord2D(this.min,this.max)};ICEMAN3D.Box2D.prototype.Clone=function(){return new ICEMAN3D.Box2D(this.min.Clone(),this.max.Clone())};ICEMAN3D.Box=function(b,a){this.min=b;this.max=a};ICEMAN3D.Box.prototype.Set=function(b,a){this.min=b;this.max=a};ICEMAN3D.Box.prototype.GetCenter=function(){return ICEMAN3D.MidCoord(this.min,this.max)};ICEMAN3D.Box.prototype.GetSize=function(){return ICEMAN3D.CoordSub(this.max,this.min)};ICEMAN3D.Box.prototype.Clone=function(){return new ICEMAN3D.Box(this.min.Clone(),this.max.Clone())};ICEMAN3D.Sphere=function(b,a){this.center=b;this.radius=a};ICEMAN3D.Sphere.prototype.Set=function(b,a){this.center=b;this.radius=a};ICEMAN3D.Sphere.prototype.GetCenter=function(){return this.center};ICEMAN3D.Sphere.prototype.GetRadius=function(){return this.radius};ICEMAN3D.Sphere.prototype.Clone=function(){return new ICEMAN3D.Sphere(this.center.Clone(),this.radius)};ICEMAN3D.Line2D=function(b,a){this.start=b;this.direction=a};ICEMAN3D.Line2D.prototype.Set=function(b,a){this.start=b;this.direction=a};ICEMAN3D.Line2D.prototype.Clone=function(){return new ICEMAN3D.Line2D(this.start.Clone(),this.direction.Clone())};ICEMAN3D.Line=function(b,a){this.start=b;this.direction=a};ICEMAN3D.Line.prototype.Set=function(b,a){this.start=b;this.direction=a};ICEMAN3D.Line.prototype.Clone=function(){return new ICEMAN3D.Line(this.start.Clone(),this.direction.Clone())};ICEMAN3D.Plane=function(f,e,h,g){this.a=f;this.b=e;this.c=h;this.d=g};ICEMAN3D.Plane.prototype.Set=function(f,e,h,g){this.a=f;this.b=e;this.c=h;this.d=g};ICEMAN3D.Plane.prototype.GetNormal=function(){return new ICEMAN3D.Vector(this.a,this.b,this.c)};ICEMAN3D.Plane.prototype.Clone=function(){return new ICEMAN3D.Plane(this.a,this.b,this.c,this.d)};ICEMAN3D.Material=function(b){var a={ambient:52224,diffuse:52224,specular:0,shininess:0,opacity:1,reflection:0,texture:null,textureWidth:1,textureHeight:1};ICEMAN3D.CopyObjectProperties(b,this,true);ICEMAN3D.CopyObjectProperties(a,this,false)};ICEMAN3D.Materials=function(){this.materials=[];this.defaultMaterial=new ICEMAN3D.Material()};ICEMAN3D.Materials.prototype.GetMaterial=function(a){if(a<0||a>=this.materials.length){return this.defaultMaterial}return this.materials[a]};ICEMAN3D.Materials.prototype.AddMaterial=function(a){this.materials.push(a);return this.materials.length-1};ICEMAN3D.Materials.prototype.GetDefaultMaterial=function(){return this.defaultMaterial};ICEMAN3D.Materials.prototype.Count=function(){return this.materials.length};ICEMAN3D.StlData=function(a,e){var b=new THREE.Vector3();var d=new THREE.Matrix3();var c="";c+="solid exported\n";a.scene.traverse(function(k){if(k instanceof THREE.Mesh&&k.name==e){var q=k.geometry;var f=k.matrixWorld;if(q instanceof THREE.BufferGeometry){q=new THREE.Geometry().fromBufferGeometry(q)}if(q instanceof THREE.Geometry){var o=q.vertices;var g=q.faces;d.getNormalMatrix(f);for(var n=0,h=g.length;n<h;n++){var p=g[n];b.copy(p.normal).applyMatrix3(d).normalize();c+="\tfacet normal "+b.x+" "+b.y+" "+b.z+"\n";c+="\t\touter loop\n";var r=[p.a,p.b,p.c];for(var m=0;m<3;m++){b.copy(o[r[m]]).applyMatrix4(f);c+="\t\t\tvertex "+b.x+" "+b.y+" "+b.z+"\n"}c+="\t\tendloop\n";c+="\tendfacet\n"}}}});c+="endsolid exported\n";return c};ICEMAN3D.StlBinaryData=function(b,i){var d=new THREE.Vector3();var g=new THREE.Matrix3();var e=0;b.scene.traverse(function(j){if(j instanceof THREE.Mesh&&j.name==i){if(j.geometry instanceof THREE.BufferGeometry){j.geometry=new THREE.Geometry().fromBufferGeometry(j.geometry)}if(j.geometry instanceof THREE.Geometry){e+=j.geometry.faces.length}}});var f=80;var a=e*2+e*3*4*4+80+4;var h=new ArrayBuffer(a);var c=new DataView(h);c.setUint32(f,e,true);f+=4;b.scene.traverse(function(o){if(!(o instanceof THREE.Mesh)||o.name!=i){return}if(o.geometry instanceof THREE.BufferGeometry){o.geometry=new THREE.Geometry().fromBufferGeometry(o.geometry)}if(!(o.geometry instanceof THREE.Geometry)){return}var t=o.geometry;var k=o.matrixWorld;var r=t.vertices;var m=t.faces;g.getNormalMatrix(k);for(var q=0,n=m.length;q<n;q++){var s=m[q];d.copy(s.normal).applyMatrix3(g).normalize();c.setFloat32(f,d.x,true);f+=4;c.setFloat32(f,d.y,true);f+=4;c.setFloat32(f,d.z,true);f+=4;var u=[s.a,s.b,s.c];for(var p=0;p<3;p++){d.copy(r[u[p]]).applyMatrix4(k);c.setFloat32(f,d.x,true);f+=4;c.setFloat32(f,d.y,true);f+=4;c.setFloat32(f,d.z,true);f+=4}c.setUint16(f,0,true);f+=2}});return c};ICEMAN3D.SaveStl=function(a,f,d){var c=d&&false?ICEMAN3D.StlBinaryData(a,f):ICEMAN3D.StlData(a,f);var b;try{b=new Blob([c],{type:"text/plain"})}catch(g){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(window.BlobBuilder){var h=new BlobBuilder();h.append(c);b=h.getBlob("text/plain")}}saveAs(b,f+".stl")}
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
;var saveAs=saveAs||(function(h){if(typeof navigator!=="undefined"&&/MSIE [1-9]\./.test(navigator.userAgent)){return}var s=h.document,m=function(){return h.URL||h.webkitURL||h},o=s.createElementNS("http://www.w3.org/1999/xhtml","a"),f="download" in o,k=function(u){var t=new MouseEvent("click");u.dispatchEvent(t)},b=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),p=h.webkitRequestFileSystem,q=h.requestFileSystem||p||h.mozRequestFileSystem,n=function(t){(h.setImmediate||h.setTimeout)(function(){throw t},0)},c="application/octet-stream",l=0,i=500,j=function(u){var t=function(){if(typeof u==="string"){m().revokeObjectURL(u)}else{u.remove()}};if(h.chrome){t()}else{setTimeout(t,i)}},r=function(u,t,x){t=[].concat(t);var w=t.length;while(w--){var y=u["on"+t[w]];if(typeof y==="function"){try{y.call(u,x||u)}catch(v){n(v)}}}},g=function(t){if(/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)){return new Blob(["\ufeff",t],{type:t.type})}return t},e=function(t,u,v){if(!v){t=g(t)}var w=this,C=t.type,F=false,y,x,B=function(){r(w,"writestart progress write writeend".split(" "))},E=function(){if(x&&b&&typeof FileReader!=="undefined"){var G=new FileReader();G.onloadend=function(){var I=G.result;x.location.href="data:attachment/file"+I.slice(I.search(/[,;]/));w.readyState=w.DONE;B()};G.readAsDataURL(t);w.readyState=w.INIT;return}if(F||!y){y=m().createObjectURL(t)}if(x){x.location.href=y}else{var H=h.open(y,"_blank");if(H==undefined&&b){h.location.href=y}}w.readyState=w.DONE;B();j(y)},A=function(G){return function(){if(w.readyState!==w.DONE){return G.apply(this,arguments)}}},z={create:true,exclusive:false},D;w.readyState=w.INIT;if(!u){u="download"}if(f){y=m().createObjectURL(t);o.href=y;o.download=u;setTimeout(function(){k(o);B();j(y);w.readyState=w.DONE});return}if(h.chrome&&C&&C!==c){D=t.slice||t.webkitSlice;t=D.call(t,0,t.size,c);F=true}if(p&&u!=="download"){u+=".download"}if(C===c||p){x=h}if(!q){E();return}l+=t.size;q(h.TEMPORARY,l,A(function(G){G.root.getDirectory("saved",z,A(function(H){var I=function(){H.getFile(u,z,A(function(J){J.createWriter(A(function(K){K.onwriteend=function(L){x.location.href=J.toURL();w.readyState=w.DONE;r(w,"writeend",L);j(J)};K.onerror=function(){var L=K.error;if(L.code!==L.ABORT_ERR){E()}};"writestart progress write abort".split(" ").forEach(function(L){K["on"+L]=w["on"+L]});K.write(t);w.abort=function(){K.abort();w.readyState=w.DONE};w.readyState=w.WRITING}),E)}),E)};H.getFile(u,{create:false},A(function(J){J.remove();I()}),A(function(J){if(J.code===J.NOT_FOUND_ERR){I()}else{E()}}))}),E)}),E)},d=e.prototype,a=function(u,v,t){return new e(u,v,t)};if(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob){return function(u,v,t){if(!t){u=g(u)}return navigator.msSaveOrOpenBlob(u,v||"download")}}d.abort=function(){var t=this;t.readyState=t.DONE;r(t,"abort")};d.readyState=d.INIT=0;d.WRITING=1;d.DONE=2;d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null;return a}(typeof self!=="undefined"&&self||typeof window!=="undefined"&&window||this.content));if(typeof module!=="undefined"&&module.exports){module.exports.saveAs=saveAs}else{if((typeof define!=="undefined"&&define!==null)&&(define.amd!=null)){define([],function(){return saveAs})}};